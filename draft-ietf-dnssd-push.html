<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DNS Push Notifications</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Motivation"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Overview"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Transport"/>
<link href="#rfc.section.5" rel="Chapter" title="5 State Considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Protocol Operation"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Discovery"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 DNS Push Notification SUBSCRIBE"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 DNS Push Notification UNSUBSCRIBE"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 DNS Push Notification Update Messages"/>
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 DNS RECONFIRM"/>
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 DNS Push Notification Termination Message"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Security Services"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 TLS Name Authentication"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 TLS Compression"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 TLS Session Resumption"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="10 References"/>
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.0 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Pusateri, T. and S. Cheshire" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-dnssd-push-05" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-1-29" />
  <meta name="dct.abstract" content="The Domain Name System (DNS) was designed to return matching records efficiently for queries for data that is relatively static. When those records change frequently, DNS is still efficient at returning the updated results when polled. But there exists no mechanism for a client to be asynchronously notified when these changes occur. This document defines a mechanism for a client to be notified of such changes to DNS records, called DNS Push Notifications." />
  <meta name="description" content="The Domain Name System (DNS) was designed to return matching records efficiently for queries for data that is relatively static. When those records change frequently, DNS is still efficient at returning the updated results when polled. But there exists no mechanism for a client to be asynchronously notified when these changes occur. This document defines a mechanism for a client to be notified of such changes to DNS records, called DNS Push Notifications." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Internet Engineering Task Force</td>
  <td class="right">T. Pusateri</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Seeking affiliation</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">S. Cheshire</td>
</tr>
<tr>
  <td class="left">Expires: August 1, 2016</td>
  <td class="right">Apple Inc.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">January 29, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DNS Push Notifications<br />
  <span class="filename">draft-ietf-dnssd-push-05</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The Domain Name System (DNS) was designed to return matching records efficiently for queries for data that is relatively static. When those records change frequently, DNS is still efficient at returning the updated results when polled. But there exists no mechanism for a client to be asynchronously notified when these changes occur. This document defines a mechanism for a client to be notified of such changes to DNS records, called DNS Push Notifications.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 1, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a></li>
</ul><li>2.   <a href="#rfc.section.2">Motivation</a></li>
<li>3.   <a href="#rfc.section.3">Overview</a></li>
<li>4.   <a href="#rfc.section.4">Transport</a></li>
<li>5.   <a href="#rfc.section.5">State Considerations</a></li>
<li>6.   <a href="#rfc.section.6">Protocol Operation</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Discovery</a></li>
<li>6.2.   <a href="#rfc.section.6.2">DNS Push Notification SUBSCRIBE</a></li>
<li>6.3.   <a href="#rfc.section.6.3">DNS Push Notification UNSUBSCRIBE</a></li>
<li>6.4.   <a href="#rfc.section.6.4">DNS Push Notification Update Messages</a></li>
<li>6.5.   <a href="#rfc.section.6.5">DNS RECONFIRM</a></li>
<li>6.6.   <a href="#rfc.section.6.6">DNS Push Notification Termination Message</a></li>
</ul><li>7.   <a href="#rfc.section.7">Security Considerations</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Security Services</a></li>
<li>7.2.   <a href="#rfc.section.7.2">TLS Name Authentication</a></li>
<li>7.3.   <a href="#rfc.section.7.3">TLS Compression</a></li>
<li>7.4.   <a href="#rfc.section.7.4">TLS Session Resumption</a></li>
</ul><li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a></li>
<li>10.   <a href="#rfc.references">References</a></li>
<ul><li>10.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">DNS records may be updated using <a href="#RFC2136">DNS Update</a> <cite title="NONE">[RFC2136]</cite>.  Other mechanisms such as a <a href="#I-D.ietf-dnssd-hybrid">Hybrid Proxy</a> <cite title="NONE">[I-D.ietf-dnssd-hybrid]</cite> can also generate changes to a DNS zone.  This document specifies a protocol for Unicast DNS clients to subscribe to receive asynchronous notifications of changes to RRSets of interest. It is immediately relevant in the case of <a href="#RFC6763">DNS Service Discovery</a> <cite title="NONE">[RFC6763]</cite> but is not limited to that use case and provides a general DNS mechanism for DNS record change notifications. Familiarity with the DNS protocol and DNS packet formats is assumed <a href="#RFC1034">[RFC1034]</a> <a href="#RFC1035">[RFC1035]</a> <a href="#RFC6195">[RFC6195]</a>.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">"Key words for use in RFCs to Indicate Requirement Levels"</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Motivation</h1>
<p id="rfc.section.2.p.1">As the domain name system continues to adapt to new uses and changes in deployment, polling has the potential to burden DNS servers at many levels throughout the network. Other network protocols have successfully deployed a publish/subscribe model to state changes following the Observer design pattern. <a href="#XEP0060">XMPP Publish-Subscribe</a> <cite title="NONE">[XEP0060]</cite> and <a href="#RFC4287">Atom</a> <cite title="NONE">[RFC4287]</cite> are examples. While DNS servers are generally highly tuned and capable of a high rate of query/response traffic, adding a publish/subscribe model for tracking changes to DNS records can result in more timely notification of changes with reduced CPU usage and lower network traffic.</p>
<p><a href="#RFC6762">Multicast DNS</a> <cite title="NONE">[RFC6762]</cite> implementations always listen on a well known link-local IP multicast group, and new services and updates are sent for all group members to receive. Therefore, Multicast DNS already has asynchronous change notification capability. However, when <a href="#RFC6763">DNS Service Discovery</a> <cite title="NONE">[RFC6763]</cite> is used across a wide area network using Unicast DNS (possibly facilitated via a <a href="#I-D.ietf-dnssd-hybrid">Hybrid Proxy</a> <cite title="NONE">[I-D.ietf-dnssd-hybrid]</cite>) it would be beneficial to have an equivalent capability for Unicast DNS, to allow clients to learn about DNS record changes in a timely manner without polling.</p>
<p><a href="#I-D.sekar-dns-llq">DNS Long-Lived Queries (LLQ)</a> <cite title="NONE">[I-D.sekar-dns-llq]</cite> is an existing deployed solution to provide asynchronous change notifications. Even though it can be used over TCP, LLQ is defined primarily as a UDP-based protocol, and as such it defines its own equivalents of existing TCP features like the three-way handshake. This document builds on experience gained with the LLQ protocol, with an improved design that uses long-lived TCP connections instead of UDP (and therefore doesn't need to duplicate existing TCP functionality), and adopts the syntax and semantics of <a href="#RFC2136">DNS Update messages</a> <cite title="NONE">[RFC2136]</cite> instead of inventing a new vocabulary of messages to communicate DNS zone changes.</p>
<p id="rfc.section.2.p.4">Because DNS Push Notifications impose a certain load on the responding server (though less load than rapid polling of that server) DNS Push Notification clients SHOULD exercise restraint in issuing DNS Push Notification subscriptions. A subscription SHOULD only be active when there is a valid reason to need live data (for example, an on-screen display is currently showing the results of that subscription to the user) and the subscription SHOULD be cancelled as soon as the need for that data ends (for example, when the user dismisses that display).</p>
<p id="rfc.section.2.p.5">A DNS Push Notification client MUST NOT routinely keep a DNS Push Notification subscription active 24 hours a day 7 days a week just to keep a list in memory up to date so that it will be really fast if the user does choose to bring up an on-screen display of that data. DNS Push Notifications are designed to be fast enough that there is no need to pre-load a "warm" list in memory just in case it might be needed later.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Overview</h1>
<p id="rfc.section.3.p.1">The existing <a href="#RFC2136">DNS Update protocol</a> <cite title="NONE">[RFC2136]</cite> provides a mechanism for clients to add or delete individual resource records (RRs) or entire resource record sets (RRSets) on the zone's server. Adopting this existing syntax and semantics for DNS Push Notifications allows for messages going in the other direction, from server to client, to communicate changes to a zone. The client first must subscribe for Push Notifications by connecting to the server and sending DNS message(s) indicating the RRSet(s) of interest. When the client loses interest in updates to these records, it unsubscribes.</p>
<p id="rfc.section.3.p.2">The DNS Push Notification server for a zone is any server capable of generating the correct change notifications for a name. It may be a master, slave, or stealth name server <a href="#RFC1996">[RFC1996]</a>.  Consequently, the <samp>_dns&#8209;push&#8209;tls._tcp.&lt;zone&gt;</samp> SRV record for a &lt;zone&gt; MAY reference the same target host and port as that zone's <samp>_dns&#8209;update&#8209;tls._tcp.&lt;zone&gt;</samp> SRV record. When the same target host and port is offered for both DNS Updates and DNS Push Notifications, a client MAY use a single TCP connection to that server for DNS Updates, DNS Queries, and DNS Push Notification Queries.</p>
<p id="rfc.section.3.p.3">DNS Push Notification clients are NOT required to implement DNS Update Prerequisite processing. Prerequisites are used to perform tentative atomic test-and-set type operations on the server, and that concept has no application when it comes to an authoritative server informing a client of changes to DNS records.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Transport</h1>
<p id="rfc.section.4.p.1">Implementations of <a href="#RFC2136">DNS Update</a> <cite title="NONE">[RFC2136]</cite> MAY use either User Datagram Protocol <a href="#RFC0768">(UDP)</a> <cite title="NONE">[RFC0768]</cite> or Transmission Control Protocol <a href="#RFC0793">(TCP)</a> <cite title="NONE">[RFC0793]</cite> as the transport protocol, in keeping with the historical precedent that DNS queries must first be sent over UDP <a href="#RFC1123">[RFC1123]</a>. This requirement to use UDP has subsequently been relaxed <a href="#RFC5966">[RFC5966]</a><a href="#I-D.ietf-dnsop-5966bis">[I-D.ietf-dnsop-5966bis]</a>. Following that precendent, DNS Push Notification is defined only for TCP. DNS Push Notification clients MUST use TLS over TCP.</p>
<p id="rfc.section.4.p.2">Either end of the TCP connection can terminate all of the subscriptions on that connection by simply closing the connection abruptly with a TCP FIN or RST. (An individual subscription is terminated by sending an UNSUBSCRIBE message for that specific subscription.)</p>
<p id="rfc.section.4.p.3">If a client closes the connection, it is signaling that it is no longer interested in receiving updates to any of the records it has subscribed. It is informing the server that the server may release all state information it has been keeping with regards to this client. This may occur because the client computer has been disconnected from the network, has gone to sleep, or the application requiring the records has terminated.</p>
<p id="rfc.section.4.p.4">If a server closes the connection, it is informing the client that it can no longer provide updates for the subscribed records. This may occur because the server application software or operating system is restarting, the application terminated unexpectedly, the server is undergoing maintenance procedures, or the server is overloaded and can no longer provide the information to all the clients that wish to receive it. The client can try to re-subscribe at a later time or connect to another server supporting DNS Push Notifications for the zone.</p>
<p id="rfc.section.4.p.5">Connection setup over TCP ensures return reachability and alleviates concerns of state overload at the server through anonymous subscriptions. All subscribers are guaranteed to be reachable by the server by virtue of the TCP three-way handshake. Because TCP SYN flooding attacks are possible with any protocol over TCP, implementers are encouraged to use industry best practices to guard against such attacks <a href="#IPJ.9-4-TCPSYN">[IPJ.9-4-TCPSYN]</a> <a href="#RFC4953">[RFC4953]</a>.</p>
<p id="rfc.section.4.p.6">Transport Layer Security <a href="#RFC5246">(TLS)</a> <cite title="NONE">[RFC5246]</cite> is well understood and deployed across many protocols running over TCP. It is designed to prevent eavesdropping, tampering, or message forgery. TLS is REQUIRED for every connection between a client subscriber and server in this protocol specification. Additional security measures such as client authentication during TLS negotiation MAY also be employed to increase the trust relationship between client and server. Additional authentication of the SRV target using DNSSEC verification and DANE TLSA records <a href="#RFC7673">[RFC7673]</a> is strongly encouraged. See below in <a href="#tls_name_auth">Section 7.2</a> for details.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> State Considerations</h1>
<p id="rfc.section.5.p.1">Each DNS Push Notification server is capable of handling some finite number of Push Notification subscriptions. This number will vary from server to server and is based on physical machine characteristics, network bandwidth, and operating system resource allocation. After a client establishes a connection to a DNS server, each record subscription is individually accepted or rejected. Servers may employ various techniques to limit subscriptions to a manageable level. Correspondingly, the client is free to establish simultaneous connections to alternate DNS servers that support DNS Push Notifications for the zone and distribute record subscriptions at its discretion. In this way, both clients and servers can react to resource constraints. Token bucket rate limiting schemes are also effective in providing fairness by a server across numerous client requests.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> Protocol Operation</h1>
<p id="rfc.section.6.p.1">A DNS Push Notification exchange begins with the client discovering the appropriate server, and then making a TLS/TCP connection to it. The client may then add and remove Push Notification subscriptions over this connection. In accordance with the current set of active subscriptions the server sends relevant asynchronous Push Notifications to the client. Note that a client MUST be prepared to receive (and silently discard) Push Notifications for subscriptions it has previously removed, since there is no way to prevent the situation where a Push Notification is in flight from server to client while the client's UNSUBSCRIBE message cancelling that subscription is simultaneously in flight from client to server.</p>
<p id="rfc.section.6.p.2">The exchange between client and server terminates when either end closes the TCP connection with a TCP FIN or RST.</p>
<p id="rfc.section.6.p.3">A client SHOULD NOT make multiple TLS/TCP connections to the same DNS Push Notification server. A client SHOULD share a single TLS/TCP connection for all requests to the same DNS Push Notification server. This shared connection should be used for all DNS Queries and DNS Push Notification Queries queries to that server, and for DNS Update requests too when the <samp>_dns&#8209;update&#8209;tls._tcp.&lt;zone&gt;</samp> SRV record indicates that the same server also handles DNS Update requests. This is to reduce unnecessary load on the DNS Push Notification server.</p>
<p id="rfc.section.6.p.4">For the purposes here, the determination of "same server" is made by inspecting the target hostname and port, regardless of the name being queried, or what zone if falls within. A given server may support Push Notifications (and possibly DNS Updates too) for multiple DNS zones. When a client discovers that the DNS Push Notification server (and/or DNS Update server) for several different names (including names that fall within different zones) is the same target hostname and port, the client SHOULD use a single shared TCP connection for all relevant operations on those names. A client SHOULD NOT open multiple TCP connections to the same target host and port just because the names being queried (or updated) happen to fall within different zones.</p>
<p id="rfc.section.6.p.5">Note that the "same server" determination described here is made using the target hostname given in the SRV record, not the IP address(es) that the hostname resolves to. If two different target hostnames happen to resolve to the same IP address(es), then the client SHOULD NOT recognize these as the "same server" for the purposes of using a single shared connection to that server. If an administrator wishes to use a single server for multiple zones and/or multiple roles (e.g., both DNS Push Notifications and DNS Updates), and wishes to have clients use a single shared connection for operations on that server, then the administrator MUST use the same target hostname in the appropriate SRV records.</p>
<p id="rfc.section.6.p.6">However, a single client device may be home to multiple independent client software instances that don't know about each other, so a DNS Push Notification server MUST be prepared to accept multiple connections from the same client IP address. This is undesirable from an efficiency stanpoint, but may be unavoidable in some situations, so a DNS Push Notification server MUST be prepared to accept multiple connections from the same client IP address.</p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#discovery" id="discovery">Discovery</a></h1>
<p id="rfc.section.6.1.p.1">The first step in DNS Push Notification subscription is to discover an appropriate DNS server that supports DNS Push Notifications for the desired zone. The client MUST also determine which TCP port on the server is listening for connections, which need not be (and often is not) the typical TCP port 53 used for conventional DNS.</p>
<p/>

<ol>
  <li>The client begins the discovery by sending a DNS query to the local resolver with record type <a href="#RFC1035">SOA</a> <cite title="NONE">[RFC1035]</cite> for the name of the record it wishes to subscribe.</li>
  <li>If the SOA record exists, it MUST be returned in the Answer Section of the reply. If not, the server SHOULD include the SOA record for the zone of the requested name in the Authority Section.</li>
  <li>If no SOA record is returned, the client then strips off the leading label from the requested name. If the resulting name has at least one label in it, the client sends a new SOA query and processing continues at step 2 above. If the resulting name is empty (the root label) then this is a network configuration error and the client gives up. The client MAY retry the operation at a later time.</li>
  <li>Once the SOA is known, the client sends a DNS query with type <a href="#RFC2782">SRV</a> <cite title="NONE">[RFC2782]</cite> for the record name <samp>_dns&#8209;push&#8209;tls._tcp.&lt;zone&gt;</samp>, where &lt;zone&gt; is the owner name of the discovered SOA record.</li>
  <li>If the zone in question does not offer DNS Push Notifications then SRV record MUST NOT exist and the SRV query will return a negative answer.</li>
  <li>If the zone in question is set up to offer DNS Push Notifications then this SRV record MUST exist.  The SRV <samp>target</samp> contains the name of the server providing DNS Push Notifications for the zone. The port number on which to contact the server is in the SRV record <samp>port</samp> field. The address(es) of the target host MAY be included in the Additional Section, however, the address records SHOULD be authenticated before use as described below in <a href="#tls_name_auth">Section 7.2</a> <a href="#RFC7673">[RFC7673]</a>.</li>
  <li>More than one SRV record may be returned. In this case, the <samp>priority</samp> and <samp>weight</samp> values in the returned SRV records are used to determine the order in which to contact the servers for subscription requests. As described in <a href="#RFC2782">the SRV specification</a> <cite title="NONE">[RFC2782]</cite>, the server with the lowest <samp>priority</samp> is first contacted. If more than one server has the same <samp>priority</samp>, the <samp>weight</samp> is indicates the weighted probability that the client should contact that server. Higher weights have higher probabilities of being selected. If a server is not reachable or is not willing to accept a subscription request, then a subsequent server is to be contacted.</li>
</ol>

<p> If a server closes a DNS Push Notification subscription connection, the client SHOULD repeat the discovery process in order to determine the preferred DNS server for subscriptions at that time.  </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> DNS Push Notification SUBSCRIBE</h1>
<p id="rfc.section.6.2.p.1">A DNS Push Notification client indicates its desire to receive DNS Push Notifications for a given domain name by sending a SUBSCRIBE request over the established TCP connection to the server. A SUBSCRIBE request is formatted identically to a conventional <a href="#RFC1035">DNS QUERY request</a> <cite title="NONE">[RFC1035]</cite>, except that the opcode is SUBSCRIBE (6) instead of QUERY (0). If neither QTYPE nor QCLASS are ANY (255) then this is a specific subscription to changes for the given name, type and class. If one or both of QTYPE or QCLASS are ANY (255) then this subscription matches any type and/or any class, as appropriate.</p>
<p id="rfc.section.6.2.p.2">In a SUBSCRIBE request the DNS Header QR bit MUST be zero.<br/> If the QR bit is not zero the message is not a SUBSCRIBE request.</p>
<p id="rfc.section.6.2.p.3">The AA, TC, RD, RA, Z, AD, and CD bits, the ID field, and the RCODE field, MUST be zero on transmission, and MUST be silently ignored on reception.</p>
<p id="rfc.section.6.2.p.4">Like a DNS QUERY request, a SUBSCRIBE request MUST contain exactly one question. Since SUBSCRIBE requests are sent over TCP, multiple SUBSCRIBE requests can be concatenated in a single TCP stream and packed efficiently into TCP segments, so the ability to pack multiple SUBSCRIBE operations into a single DNS message within that TCP stream would add extra complexity for little benefit.</p>
<p id="rfc.section.6.2.p.5">ANCOUNT MUST be zero, and the Answer Section MUST be empty.<br/> Any records in the Answer Section MUST be silently ignored.</p>
<p id="rfc.section.6.2.p.6">NSCOUNT MUST be zero, and the Authority Section MUST be empty.<br/> Any records in the Authority Section MUST be silently ignored.</p>
<p id="rfc.section.6.2.p.7">ARCOUNT MUST be zero, and the Additional Section MUST be empty.<br/> Any records in the Additional Section MUST be silently ignored.</p>
<p id="rfc.section.6.2.p.8">Each SUBSCRIBE request generates exactly one SUBSCRIBE response from the server.</p>
<p id="rfc.section.6.2.p.9">In the SUBSCRIBE response the RCODE indicates whether or not the subscription was accepted. Supported RCODEs are as follows:</p>
<div id="rfc.table.1"/>
<div id="table_update_rcodes"/>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <caption>Response codes</caption>
  <thead>
    <tr>
      <th class="left">Mnemonic</th>
      <th class="center">Value</th>
      <th class="left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">NOERROR</td>
      <td class="center">0</td>
      <td class="left">SUBSCRIBE successful</td>
    </tr>
    <tr>
      <td class="left">FORMERR</td>
      <td class="center">1</td>
      <td class="left">Server failed to process request due to a malformed request</td>
    </tr>
    <tr>
      <td class="left">SERVFAIL</td>
      <td class="center">2</td>
      <td class="left">Server failed to process request due to resource exhaustion</td>
    </tr>
    <tr>
      <td class="left">NOTIMP</td>
      <td class="center">4</td>
      <td class="left">Server does not implement DNS Push Notifications</td>
    </tr>
    <tr>
      <td class="left">REFUSED</td>
      <td class="center">5</td>
      <td class="left">Server refuses to process request for policy or security reasons</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.6.2.p.10">In a SUBSCRIBE response the DNS Header QR bit MUST be one.<br/> If the QR bit is not one the message is not a SUBSCRIBE response.</p>
<p id="rfc.section.6.2.p.11">The AA, TC, RD, RA, Z, AD, and CD bits, and the ID field, MUST be zero on transmission, and MUST be silently ignored on reception.</p>
<p id="rfc.section.6.2.p.12">The Question Section MUST echo back the values provided by the client in the SUBSCRIBE request that generated this SUBSCRIBE response.</p>
<p id="rfc.section.6.2.p.13">ANCOUNT MUST be zero, and the Answer Section MUST be empty.<br/> Any records in the Answer Section MUST be silently ignored.<br/> If the subscription was accepted and there are positive answers for the requested name, type and class, then these positive answers MUST be communicated to the client in an immediately following Push Notification Update, not in the Answer Section of the SUBSCRIBE response.  This simplifying requirement is made so that there is only a single way that information is communicated to a DNS Push Notification client. Since a DNS Push Notification client has to parse information received via Push Notification Updates anyway, it is simpler if it does not also have to parse information received via the Answer Section of a SUBSCRIBE response.</p>
<p id="rfc.section.6.2.p.14">NSCOUNT MUST be zero, and the Authority Section MUST be empty.<br/> Any records in the Authority Section MUST be silently ignored.</p>
<p id="rfc.section.6.2.p.15">ARCOUNT MUST be zero, and the Additional Section MUST be empty.<br/> Any records in the Additional Section MUST be silently ignored.</p>
<p id="rfc.section.6.2.p.16">If accepted, the subscription will stay in effect until the client revokes the subscription or until the connection between the client and the server is closed.</p>
<p id="rfc.section.6.2.p.17">SUBSCRIBE requests on a given connection MUST be unique. A client MUST NOT send a SUBSCRIBE message that duplicates the name, type and class of an existing active subscription on that TLS/TCP connection. For the purpose of this matching, the established DNS case-insensitivity for US-ASCII letters applies (e.g., "foo.com" and "Foo.com" are the same). If a server receives such a duplicate SUBSCRIBE message this is an error and the server MUST immediately close the TCP connection.</p>
<p id="rfc.section.6.2.p.18">DNS wildcarding is not supported. That is, a wildcard ("*") in a SUBSCRIBE message matches only a wildcard ("*") in the zone, and nothing else.</p>
<p id="rfc.section.6.2.p.19">Aliasing is not supported. That is, a CNAME in a SUBSCRIBE message matches only a CNAME in the zone, and nothing else.</p>
<p id="rfc.section.6.2.p.20">A client may SUBSCRIBE to records that are unknown to the server at the time of the request (providing that the name falls within one of the zone(s) the server is responsible for) and this is not an error. The server MUST accept these requests and send Push Notifications if and when matches are found in the future.</p>
<p id="rfc.section.6.2.p.21">Since all SUBSCRIBE operations are implicitly long-lived operations, the server MUST interpret a SUBSCRIBE request as if it contained an EDNS0 TCP Keepalive option <a href="#I-D.ietf-dnsop-edns-tcp-keepalive">[I-D.ietf-dnsop-edns-tcp-keepalive]</a>. A client MUST NOT include an actual EDNS0 TCP Keepalive option in the request, since it is automatic, and implied by the semantics of SUBSCRIBE. If a server receives a SUBSCRIBE request that does contain an actual EDNS0 TCP Keepalive option this is an error and the server MUST immediately close the TCP connection. In a SUBSCRIBE response the server MUST include an EDNS0 TCP Keepalive option specifying the idle timeout so that the client knows the frequency of keepalives it must generate to keep the connection alive. If the client receives a SUBSCRIBE response that does not contain an EDNS0 TCP Keepalive option this is an error and the client MUST immediately close the TCP connection.</p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> DNS Push Notification UNSUBSCRIBE</h1>
<p id="rfc.section.6.3.p.1">To cancel an individual subscription without closing the entire connection, the client sends an UNSUBSCRIBE message over the established TCP connection to the server. The UNSUBSCRIBE message is formatted identically to the SUBSCRIBE message which created the subscription, with the exact same name, type and class, except that the opcode is UNSUBSCRIBE (7) instead of SUBSCRIBE (6).</p>
<p id="rfc.section.6.3.p.2">A client MUST NOT send an UNSUBSCRIBE message that does not exactly match the name, type and class of an existing active subscription on that TLS/TCP connection. If a server receives such an UNSUBSCRIBE message this is an error and the server MUST immediately close the connection.</p>
<p id="rfc.section.6.3.p.3">No response message is generated as a result of processing an UNSUBSCRIBE message.</p>
<p id="rfc.section.6.3.p.4">Having being successfully revoked with a correctly-formatted UNSUBSCRIBE message, the previously referenced subscription is no longer active and the server MAY discard the state associated with it immediately, or later, at the server's discretion.</p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> DNS Push Notification Update Messages</h1>
<p id="rfc.section.6.4.p.1">Once a subscription has been successfully established, the server generates Push Notification Updates to send to the client as appropriate. An initial Push Notification Update will be sent immediately in the case that the answer set was non-empty at the moment the subscription was established. Subsequent changes to the answer set are then communicated to the client in subsequent Push Notification Updates.</p>
<p id="rfc.section.6.4.p.2">The format of Push Notification Updates borrows from the existing <a href="#RFC2136">DNS Update</a> <cite title="NONE">[RFC2136]</cite> protocol, with some simplifications.</p>
<div id="rfc.figure.1"/>
<div id="packet_header1"/>
<pre>
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      ID                       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|QR|   Opcode  |          Z         |   RCODE   |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ZOCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    PRCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    UPCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ADCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
               </pre>
<p class="figure">Figure 1</p>
<p id="rfc.section.6.4.p.3">The following figure shows the existing DNS Update header format: </p>
<p id="rfc.section.6.4.p.4">For DNS Push Notifications the following rules apply:</p>
<p id="rfc.section.6.4.p.5">The QR bit MUST be zero, and the Opcode MUST be UPDATE (5).<br/> Messages received where this is not true are not Push Notification Update Messages and should be silently ignored for the purposes of Push Notification Update Message handling.</p>
<p id="rfc.section.6.4.p.6">ID, the Z bits, and RCODE MUST be zero on transmission,<br/> and MUST be silently ignored on reception.</p>
<p id="rfc.section.6.4.p.7">ZOCOUNT MUST be zero, and the Zone Section MUST be empty.<br/> Any records in the Zone Section MUST be silently ignored.</p>
<p id="rfc.section.6.4.p.8">PRCOUNT MUST be zero, and the Prerequisite Section MUST be empty.<br/> Any records in the Prerequisite Section MUST be silently ignored.</p>
<p id="rfc.section.6.4.p.9">ADCOUNT MUST be zero, and the Additional Data Section MUST be empty.<br/> Any records in the Additional Data Section MUST be silently ignored.</p>
<p id="rfc.section.6.4.p.10">The Update Section contains the relevant change information for the client, formatted identically to a <a href="#RFC2136">DNS Update</a> <cite title="NONE">[RFC2136]</cite>. To recap: </p>

<ul class="empty">
  <li>Delete all RRsets from a name:<br/> TTL=0, CLASS=ANY, RDLENGTH=0, TYPE=ANY.</li>
  <li>Delete an RRset from a name:<br/> TTL=0, CLASS=ANY, RDLENGTH=0;<br/> TYPE specifies the RRset being deleted.</li>
  <li>Delete an individual RR from a name:<br/> TTL=0, CLASS=NONE;<br/> TYPE, RDLENGTH and RDATA specifies the RR being deleted.</li>
  <li>Add an individual RR to a name:<br/> TTL, CLASS, TYPE, RDLENGTH and RDATA specifies the RR being added.</li>
</ul>

<p> </p>
<p id="rfc.section.6.4.p.11">Upon reception of a Push Notification Update Message, the client receiving the message MUST validate that the records being added or deleted correspond with at least one currently active subscription on that connection. Specifically, the record name MUST match the name given in the SUBSCRIBE request, subject to the usual established DNS case-insensitivity for US-ASCII letters.  If the QTYPE was not ANY (255) then the TYPE of the record must match the QTYPE given in the SUBSCRIBE request.  If the QCLASS was not ANY (255) then the CLASS of the record must match the QCLASS given in the SUBSCRIBE request.  If a matching active subscription on that connection is not found, then that individual record addition/deletion is silently ignored. Processing of other additions and deletions in this message is not affected. The TCP connection is not closed. This is to allow for the race condition where a client sends an outbound UNSUBSCRIBE while inbound Push Notification Updates for that subscription from the server are still in flight.</p>
<p id="rfc.section.6.4.p.12">In the case where a single change affects more than one active subscription, only one update is sent. For example, an update adding a given record may match both a SUBSCRIBE request with the same QTYPE and a different SUBSCRIBE request with QTYPE=ANY. It is not the case that two updates are sent because the new record matches two active subscriptions.</p>
<p id="rfc.section.6.4.p.13">The server SHOULD encode change notifications in the most efficient manner possible. For example, when three AAAA records are deleted from a given name, and no other AAAA records exist for that name, the server SHOULD send a "delete an RRset from a name" update, not three separate "delete an individual RR from a name" updates. Similarly, when both an SRV and a TXT record are deleted from a given name, and no other records of any kind exist for that name, the server SHOULD send a "delete all RRsets from a name" update, not two separate "delete an RRset from a name" updates.</p>
<p id="rfc.section.6.4.p.14">All Push Notification Update Messages MUST contain an EDNS0 TCP Keepalive option <a href="#I-D.ietf-dnsop-edns-tcp-keepalive">[I-D.ietf-dnsop-edns-tcp-keepalive]</a> specifying the idle timeout so that the client knows the frequency of keepalives it must generate to keep the connection alive. If the client receives a Push Notification Update Message that does not contain an EDNS0 TCP Keepalive option this is an error and the client MUST immediately close the TCP connection.</p>
<p id="rfc.section.6.4.p.15">Reception of a Push Notification Update Message results in no response back to the server.</p>
<p id="rfc.section.6.4.p.16">The TTL of an added record is stored by the client and decremented as time passes, with the caveat that for as long as a relevant subscription is active, the TTL does not decrement below 1 second. For as long as a relevant subscription remains active, the client SHOULD assume that when a record goes away the server will notify it of that fact. Consequently, a client does not have to poll to verify that the record is still there. Once a subscription is cancelled (individually, or as a result of the TCP connection being closed) record aging resumes and records are removed from the local cache when their TTL reaches zero.</p>
<h1 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a> DNS RECONFIRM</h1>
<p id="rfc.section.6.5.p.1">Sometimes, particularly when used with a <a href="#I-D.ietf-dnssd-hybrid">Hybrid Proxy</a> <cite title="NONE">[I-D.ietf-dnssd-hybrid]</cite>, a DNS Zone may contain stale data. When a client encounters data that it believe may be stale (e.g., an SRV record referencing a target host+port that is not responding to connection requests) the client sends a DNS RECONFIRM message to request that the server re-verify that the data is still valid. For a Hybrid Proxy, this causes it to issue new Multicast DNS requests to ascertain whether the target device is still present. For other kinds of DNS server the RECONFIRM operation is currently undefined and should be sliently ignored.  A RECONFIRM request is formatted similarly to a conventional <a href="#RFC1035">DNS QUERY request</a> <cite title="NONE">[RFC1035]</cite>, except that the opcode is RECONFIRM (8) instead of QUERY (0). QTYPE MUST NOT be the value ANY (255). QCLASS MUST NOT be the value ANY (255).</p>
<p id="rfc.section.6.5.p.2">In a RECONFIRM request the DNS Header QR bit MUST be zero.<br/> If the QR bit is not zero the message is not a RECONFIRM request.</p>
<p id="rfc.section.6.5.p.3">The AA, TC, RD, RA, Z, AD, and CD bits, the ID field, and the RCODE field, MUST be zero on transmission, and MUST be silently ignored on reception.</p>
<p id="rfc.section.6.5.p.4">Like a DNS QUERY request, a RECONFIRM request MUST contain exactly one question. Since RECONFIRM requests are sent over TCP, multiple RECONFIRM requests can be concatenated in a single TCP stream and packed efficiently into TCP segments, so the ability to pack multiple RECONFIRM operations into a single DNS message within that TCP stream would add extra complexity for little benefit.</p>
<p id="rfc.section.6.5.p.5">ANCOUNT MUST be nonzero, and the Answer Section MUST contain the rdata for the record(s) that the client believes to be in doubt.</p>
<p id="rfc.section.6.5.p.6">NSCOUNT MUST be zero, and the Authority Section MUST be empty.<br/> Any records in the Authority Section MUST be silently ignored.</p>
<p id="rfc.section.6.5.p.7">ARCOUNT MUST be zero, and the Additional Section MUST be empty.<br/> Any records in the Additional Section MUST be silently ignored.</p>
<p id="rfc.section.6.5.p.8">DNS wildcarding is not supported. That is, a wildcard ("*") in a SUBSCRIBE message matches only a wildcard ("*") in the zone, and nothing else.</p>
<p id="rfc.section.6.5.p.9">Aliasing is not supported. That is, a CNAME in a SUBSCRIBE message matches only a CNAME in the zone, and nothing else.</p>
<p id="rfc.section.6.5.p.10">No response message is generated as a result of processing a RECONFIRM message.</p>
<p id="rfc.section.6.5.p.11">If the server receiving the RECONFIRM request determines that the records are in fact no longer valid, then subsequent DNS Push Notification Update Messages will be generated to inform interested clients. Thus, one client discovering that a previously-advertised printer is no longer present has the side effect of informing all other interested clients that the printer in question is now gone.</p>
<h1 id="rfc.section.6.6"><a href="#rfc.section.6.6">6.6.</a> DNS Push Notification Termination Message</h1>
<p id="rfc.section.6.6.p.1">If a server is low on resources it MAY simply terminate a client connection with a TCP RST. However, the likely behavour of the client may be simply to reconnect immediately, putting more burden on the server. Therefore, a server MAY instead choose to shed client load by (a) sending a DNS Push Notification Termination Message and then (b) closing the client connection with a TCP FIN instead of RST, thereby facilitating reliable delivery of the Termination Message.</p>
<p id="rfc.section.6.6.p.2">The format of a Termination Message is similar to a Push Notification Update.</p>
<div id="rfc.figure.2"/>
<div id="packet_header2"/>
<pre>
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      ID                       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|QR|   Opcode  |          Z         |   RCODE   |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ZOCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    PRCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    UPCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ADCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
               </pre>
<p class="figure">Figure 2</p>
<p id="rfc.section.6.6.p.3">The following figure shows the existing DNS Update header format: </p>
<p id="rfc.section.6.6.p.4">For Termination Messages the following rules apply:</p>
<p id="rfc.section.6.6.p.5">The QR bit MUST be zero, and the Opcode MUST be UPDATE (5).<br/> Messages received where this is not true are not Termination Messages and should be silently ignored.</p>
<p id="rfc.section.6.6.p.6">ID and the Z bits MUST be zero on transmission,<br/> and MUST be silently ignored on reception.</p>
<p id="rfc.section.6.6.p.7">ZOCOUNT MUST be zero, and the Zone Section MUST be empty.<br/> Any records in the Zone Section MUST be silently ignored.</p>
<p id="rfc.section.6.6.p.8">PRCOUNT MUST be zero, and the Prerequisite Section MUST be empty.<br/> Any records in the Prerequisite Section MUST be silently ignored.</p>
<p id="rfc.section.6.6.p.9">UPCOUNT MUST be zero, and the Update Section MUST be empty.<br/> Any records in the Update Section MUST be silently ignored.</p>
<p id="rfc.section.6.6.p.10">ADCOUNT MUST be zero, and the Additional Data Section MUST be empty.<br/> Any records in the Additional Data Section MUST be silently ignored.</p>
<p id="rfc.section.6.6.p.11">The RCODE MUST contain a code giving the reason for termination. [Codes to be determined.] The Termination Message MUST contain an EDNS0 TCP Keepalive option <a href="#I-D.ietf-dnsop-edns-tcp-keepalive">[I-D.ietf-dnsop-edns-tcp-keepalive]</a> where the idle timeout indicates the time the client SHOULD wait before attempting to reconnect.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<p id="rfc.section.7.p.1">TLS support is REQUIRED in DNS Push Notifications. There is no provision for opportunistic encryption using a mechanism like <samp>STARTTLS</samp>.</p>
<p id="rfc.section.7.p.2">DNSSEC is RECOMMENDED for DNS Push Notifications. TLS alone does not provide complete security. TLS certificate verification can provide reasonable assurance that the client is really talking to the server associated with the desired host name, but since the desired host name is learned via a DNS SRV query, if the SRV query is subverted then the client may have a secure connection to a rogue server. DNSSEC can provided added confidence that the SRV query has not been subverted.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> Security Services</h1>
<p id="rfc.section.7.1.p.1">It is the goal of using TLS to provide the following security services: </p>

<dl>
  <dt>Confidentiality</dt>
  <dd style="margin-left: 8">All application-layer communication is encrypted with the goal that no party should be able to decrypt it except the intended receiver.</dd>
  <dt>Data integrity protection</dt>
  <dd style="margin-left: 8">Any changes made to the communication in transit are detectable by the receiver.</dd>
  <dt>Authentication</dt>
  <dd style="margin-left: 8">An end-point of the TLS communication is authenticated as the intended entity to communicate with.</dd>
</dl>

<p> </p>
<p id="rfc.section.7.1.p.2">Deployment recommendations on the appropriate key lengths and cypher suites are beyond the scope of this document. Please refer to <a href="#RFC7525">TLS Recommendations</a> <cite title="NONE">[RFC7525]</cite> for the best current practices. Keep in mind that best practices only exist for a snapshot in time and recommendations will continue to change. Updated versions or errata may exist for these recommendations.</p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#tls_name_auth" id="tls_name_auth">TLS Name Authentication</a></h1>
<p id="rfc.section.7.2.p.1">As described in <a href="#discovery">Section 6.1</a>, the client discovers the DNS Push Notification server using an SRV lookup for the record name <samp>_dns&#8209;push&#8209;tls._tcp.&lt;zone&gt;</samp>. The server connection endpoint SHOULD then be authenticated using DANE TLSA records for the associated SRV record. This associates the target's name and port number with a trusted TLS certificate <a href="#RFC7673">[RFC7673]</a>. This procedure uses the TLS Sever Name Indication (SNI) extension <a href="#RFC6066">[RFC6066]</a> to inform the server of the name the client has authenticated through the use of TLSA records. Therefore, if the SRV record passes DNSSEC validation and a TLSA record matching the target name is useable, an SNI extension MUST be used for the target name to ensure the client is connecting to the server it has authenticated. If the target name does not have a usable TLSA record, then the use of the SNI extension is optional.</p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> TLS Compression</h1>
<p id="rfc.section.7.3.p.1">In order to reduce the chances of compression related attacks, TLS-level compression SHOULD be disabled when using TLS versions 1.2 and earlier. In the draft version of <a href="#I-D.ietf-tls-tls13">TLS 1.3</a> <cite title="NONE">[I-D.ietf-tls-tls13]</cite>, TLS-level compression has been removed completely.</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> TLS Session Resumption</h1>
<p id="rfc.section.7.4.p.1">TLS Session Resumption is permissible on DNS Push Notification servers. The server may keep TLS state with Session IDs <a href="#RFC5246">[RFC5246]</a> or operate in stateless mode by sending a Session Ticket <a href="#RFC5077">[RFC5077]</a> to the client for it to store. However, once the connection is closed, any existing subscriptions will be dropped. When the TLS session is resumed, the DNS Push Notification server will not have any subscription state and will proceed as with any other new connection. Use of TLS Session Resumption allows a new TLS connection to be set up more quickly, but the client will still have to recreate any desired subscriptions.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.8.p.1">This document defines the service name: <samp>_dns&#8209;push&#8209;tls._tcp</samp>.<br/> It is only applicable for the TCP protocol.<br/> This name is to be published in the IANA Service Name Registry.</p>
<p id="rfc.section.8.p.2">This document defines three DNS OpCodes: SUBSCRIBE with (tentative) value 6, UNSUBSCRIBE with (tentative) value 7, and RECONFIRM with (tentative) value 8.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.9.p.1">The authors would like to thank Kiren Sekar and Marc Krochmal for previous work completed in this field.</p>
<p id="rfc.section.9.p.2">This draft has been improved due to comments from Ran Atkinson, Mark Delany, Manju Shankar Rao, and Markus Stenberg.</p>
<h1 id="rfc.references"><a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-dnsop-5966bis">[I-D.ietf-dnsop-5966bis]</b>
      </td>
      <td class="top"><a>Dickinson, J.</a>, <a>Dickinson, S.</a>, <a>Bellis, R.</a>, <a>Mankin, A.</a> and <a>D. Wessels</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dnsop-5966bis-06">DNS Transport over TCP - Implementation Requirements</a>", Internet-Draft draft-ietf-dnsop-5966bis-06, January 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-dnsop-edns-tcp-keepalive">[I-D.ietf-dnsop-edns-tcp-keepalive]</b>
      </td>
      <td class="top"><a>Wouters, P.</a>, <a>Abley, J.</a>, <a>Dickinson, S.</a> and <a>R. Bellis</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dnsop-edns-tcp-keepalive-05">The edns-tcp-keepalive EDNS0 Option</a>", Internet-Draft draft-ietf-dnsop-edns-tcp-keepalive-05, January 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-tls-tls13">[I-D.ietf-tls-tls13]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tls-tls13-11">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-11, December 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0768">[RFC0768]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc768">User Datagram Protocol</a>", STD 6, RFC 768, DOI 10.17487/RFC0768, August 1980.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0793">[RFC0793]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>", STD 7, RFC 793, DOI 10.17487/RFC0793, September 1981.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1034">[RFC1034]</b>
      </td>
      <td class="top"><a>Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>", STD 13, RFC 1034, DOI 10.17487/RFC1034, November 1987.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1035">[RFC1035]</b>
      </td>
      <td class="top"><a>Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, DOI 10.17487/RFC1035, November 1987.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1123">[RFC1123]</b>
      </td>
      <td class="top"><a>Braden, R.</a>, "<a href="http://tools.ietf.org/html/rfc1123">Requirements for Internet Hosts - Application and Support</a>", STD 3, RFC 1123, DOI 10.17487/RFC1123, October 1989.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2136">[RFC2136]</b>
      </td>
      <td class="top"><a>Vixie, P.</a>, <a>Thomson, S.</a>, <a>Rekhter, Y.</a> and <a>J. Bound</a>, "<a href="http://tools.ietf.org/html/rfc2136">Dynamic Updates in the Domain Name System (DNS UPDATE)</a>", RFC 2136, DOI 10.17487/RFC2136, April 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2782">[RFC2782]</b>
      </td>
      <td class="top"><a>Gulbrandsen, A.</a>, <a>Vixie, P.</a> and <a>L. Esibov</a>, "<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>", RFC 2782, DOI 10.17487/RFC2782, February 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4953">[RFC4953]</b>
      </td>
      <td class="top"><a>Touch, J.</a>, "<a href="http://tools.ietf.org/html/rfc4953">Defending TCP Against Spoofing Attacks</a>", RFC 4953, DOI 10.17487/RFC4953, July 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5246">[RFC5246]</b>
      </td>
      <td class="top"><a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5966">[RFC5966]</b>
      </td>
      <td class="top"><a>Bellis, R.</a>, "<a href="http://tools.ietf.org/html/rfc5966">DNS Transport over TCP - Implementation Requirements</a>", RFC 5966, DOI 10.17487/RFC5966, August 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6066">[RFC6066]</b>
      </td>
      <td class="top"><a>Eastlake 3rd, D.</a>, "<a href="http://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>", RFC 6066, DOI 10.17487/RFC6066, January 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6195">[RFC6195]</b>
      </td>
      <td class="top"><a>Eastlake 3rd, D.</a>, "<a href="http://tools.ietf.org/html/rfc6195">Domain Name System (DNS) IANA Considerations</a>", RFC 6195, DOI 10.17487/RFC6195, March 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7673">[RFC7673]</b>
      </td>
      <td class="top"><a>Finch, T.</a>, <a>Miller, M.</a> and <a>P. Saint-Andre</a>, "<a href="http://tools.ietf.org/html/rfc7673">Using DNS-Based Authentication of Named Entities (DANE) TLSA Records with SRV Records</a>", RFC 7673, DOI 10.17487/RFC7673, October 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-dnssd-hybrid">[I-D.ietf-dnssd-hybrid]</b>
      </td>
      <td class="top"><a>Cheshire, S.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dnssd-hybrid-02">Hybrid Unicast/Multicast DNS-Based Service Discovery</a>", Internet-Draft draft-ietf-dnssd-hybrid-02, November 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.sekar-dns-llq">[I-D.sekar-dns-llq]</b>
      </td>
      <td class="top"><a>Sekar, K.</a>, "<a href="http://tools.ietf.org/html/draft-sekar-dns-llq-01">DNS Long-Lived Queries</a>", Internet-Draft draft-sekar-dns-llq-01, August 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="IPJ.9-4-TCPSYN">[IPJ.9-4-TCPSYN]</b>
      </td>
      <td class="top"><a href="mailto:weddy@grc.nasa.gov" title="Verizon Federal Network Systems">Eddy, W.</a>, "<a>Defenses Against TCP SYN Flooding Attacks</a>", The Internet Protocol Journal, Cisco Systems, Volume 9, Number 4, December 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC1996">[RFC1996]</b>
      </td>
      <td class="top"><a>Vixie, P.</a>, "<a href="http://tools.ietf.org/html/rfc1996">A Mechanism for Prompt Notification of Zone Changes (DNS NOTIFY)</a>", RFC 1996, DOI 10.17487/RFC1996, August 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4287">[RFC4287]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a> and <a>R. Sayre</a>, "<a href="http://tools.ietf.org/html/rfc4287">The Atom Syndication Format</a>", RFC 4287, DOI 10.17487/RFC4287, December 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5077">[RFC5077]</b>
      </td>
      <td class="top"><a>Salowey, J.</a>, <a>Zhou, H.</a>, <a>Eronen, P.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc5077">Transport Layer Security (TLS) Session Resumption without Server-Side State</a>", RFC 5077, DOI 10.17487/RFC5077, January 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6762">[RFC6762]</b>
      </td>
      <td class="top"><a>Cheshire, S.</a> and <a>M. Krochmal</a>, "<a href="http://tools.ietf.org/html/rfc6762">Multicast DNS</a>", RFC 6762, DOI 10.17487/RFC6762, February 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6763">[RFC6763]</b>
      </td>
      <td class="top"><a>Cheshire, S.</a> and <a>M. Krochmal</a>, "<a href="http://tools.ietf.org/html/rfc6763">DNS-Based Service Discovery</a>", RFC 6763, DOI 10.17487/RFC6763, February 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7525">[RFC7525]</b>
      </td>
      <td class="top"><a>Sheffer, Y.</a>, <a>Holz, R.</a> and <a>P. Saint-Andre</a>, "<a href="http://tools.ietf.org/html/rfc7525">Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)</a>", BCP 195, RFC 7525, DOI 10.17487/RFC7525, May 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="XEP0060">[XEP0060]</b>
      </td>
      <td class="top"><a>Millard, P.</a>, <a href="mailto:peter@andyet.net">Saint-Andre, P.</a> and <a href="mailto:ralphm@ik.nu">R. Meijer</a>, "<a>Publish-Subscribe</a>", XSF XEP 0060, July 2010.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tom Pusateri</span> 
	  <span class="n hidden">
		<span class="family-name">Pusateri</span>
	  </span>
	</span>
	<span class="org vcardline">Seeking affiliation</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Hilton Head Island</span>,  
		<span class="region">SC</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 843 473 7394</span>

<span class="vcardline">EMail: <a href="mailto:pusateri@bangj.com">pusateri@bangj.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stuart Cheshire</span> 
	  <span class="n hidden">
		<span class="family-name">Cheshire</span>
	  </span>
	</span>
	<span class="org vcardline">Apple Inc.</span>
	<span class="adr">
	  <span class="vcardline">1 Infinite Loop</span>

	  <span class="vcardline">
		<span class="locality">Cupertino</span>,  
		<span class="region">CA</span> 
		<span class="code">95014</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 408 974 3207</span>

<span class="vcardline">EMail: <a href="mailto:cheshire@apple.com">cheshire@apple.com</a></span>

  </address>
</div>

</body>
</html>
